<!DOCTYPE html>
<html lang="en" dir="ltr">

    <head>
        <meta charset="utf-8">
        <title></title>
        <script src="js/jquery-3.6.0.min.js"></script>
        <script type="text/javascript" src="stories.json"></script>
        <script src='https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.js'></script>
        <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.js'></script>
        <link href='https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.css' rel='stylesheet' />
        <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.css' rel='stylesheet' />
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:700,500|Poppins:600">
        <link rel="stylesheet" href="css/style.css">
    </head>

    <body>
        <div id="wrapper">
            <div id="topbar">
                <div class="topnav">
                    <div class="topnav-logo-container">
                        <img class="topnav-logo" src="img/fts-wh-title@2x.svg" alt="FTS Logo">
                    </div>
                    <div class="topnav-links">
                        <ul>
                            <li><a href="#home">Home</a></li>
                            <li><a href="#storylist">Story List</a></li>
                            <li><a href="#taglist">Tag List</a></li>
                            <li><a class="collaboraction-button" href="#collaboraction">Collaboraction</a></li>
                        </ul>
                    </div>
                    <ul>
                </div>
                <div class="tagbar">
                    <ul>
                        <li><a href="#ANIMAL">#ANIMAL</a></li>
                        <li><a href="#ART">#ART</a></li>
                        <li><a href="#CULTURE">#CULTURE</a></li>
                        <li><a href="#EDUCATION">#EDUCATION</a></li>
                        <li><a href="#EMOTION">#EMOTION</a></li>
                        <li><a href="#EVENT">#EVENT</a></li>
                        <li><a href="#FAMILY">#FAMILY</a></li>
                        <li><a href="#HEALTH">#HEALTH</a></li>
                        <li><a href="#HISTORY">#HISTORY</a></li>
                        <li><a href="#JOB">#JOB</a></li>
                        <li><a href="#PERSON">#PERSON</a></li>
                        <li><a href="#PLACE">#PLACE</a></li>
                    </ul>
                </div>
            </div>
            <section class="content">
                <div id='map'></div>
            </section>
            <script>
                mapboxgl.accessToken = 'pk.eyJ1IjoiZ2Fpc3NlcnQiLCJhIjoiY2ttY3NpaTA0MmVwODJvbzRiMjA0cWRpaCJ9.7ZtAvTm6SxPlw8wT9aEPHw';

                var map = new mapboxgl.Map({
                    container: 'map', // container ID
                    style: 'mapbox://styles/gaissert/ckms06zdd2ks317s418229ih5', // style URL
                    zoom: 10,
                    center: [-87.610, 41.873]
                });

                map.scrollZoom.disable();
                map.boxZoom.disable();
                map.dragPan.disable();
                map.dragRotate.disable();
                map.keyboard.disable();
                map.touchZoomRotate.disable();
                map.touchPitch.disable();
                map.doubleClickZoom.disable();


                map.on('style.load', function() {
                    var geojson = data;
                    var popup = null;
                    var openPopup = null;
                    geojson.features.forEach(function(marker) {
                        map.addSource(marker.properties.id, {
                            'type': 'geojson',
                            'data': {
                                'type': 'FeatureCollection',
                                'features': [
                                    marker
                                ]
                            }
                        });
                        map.addLayer({
                            'id': marker.properties.id,
                            'source': marker.properties.id,
                            'type': 'circle',
                            'paint': {
                                'circle-radius': 12,
                                'circle-color': "#FFA800"
                            }
                        });
                        map.on('click', marker.properties.id, function(e) {
                            if (popup === null || openPopup !== marker.properties.id) {
                                map.setPaintProperty(marker.properties.id, 'circle-radius', 26);

                                var coordinates = e.features[0].geometry.coordinates.slice();
                                var name = e.features[0].properties.name;
                                var categories = e.features[0].properties.categories.replace(/[\[\]']+/g, '');

                                categories = categories.split(",");
                                categories.forEach(function(element, index, array) {
                                    element = "#" + element.slice(1, -1).toUpperCase();
                                    array[index] = "<a href=\"" + element + "\">" + element + "</a>";
                                });

                                categories = categories.sort().join(', ');

                                while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
                                    coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
                                }
                                openPopup = marker.properties.id;

                                popup = new mapboxgl.Popup();
                                var content = "<div class=\"story-container\"><div>Story: " + name + "</div>" +
                                    "<div>Location: " + "</div>" +
                                    "<div>Tags: " + categories + "</div></div><div class=\"watch-button-container\"><a class=\"watch-button\" href=\"#watch\">Watch</a></div>";
                                popup.setLngLat(coordinates).setHTML(content).addTo(map);
                                popup.on('close', function(e) {
                                    map.setPaintProperty(marker.properties.id, 'circle-radius', 12);
                                    popup = null;
                                    openPopup = null;
                                });
                            }
                        });

                        map.on('mouseenter', marker.properties.id, function() {
                            map.getCanvas().style.cursor = 'pointer';
                        });

                        map.on('mouseleave', marker.properties.id, function() {
                            map.getCanvas().style.cursor = '';
                        });
                    });

                });
            </script>
            <div class="botbar">
                <div class="collab-logo">
                    <a href="https://www.collaboraction.org/" target="_blank" rel="noopener noreferrer">
                        <img src="img/collaboraction-logo-dark-alpha-2@2x.svg" alt="Collaboraction.org">
                    </a>
                </div>
                <div class="social">
                    <ul>
                        <li>
                            <a href="https://www.facebook.com/collaboraction" target="_blank" rel="noopener noreferrer">
                                <img src="img/e0678ef25486466ba65ef6ad47b559e1-1@2x.svg" alt="Facebook">
                            </a>
                        </li>
                        <li>
                            <a href="https://www.instagram.com/collaboraction/" target="_blank" rel="noopener noreferrer">
                                <img src="img/da7ef6dd1302486c9a67baebe4b364bc-1@2x.svg" alt="Instagram">
                            </a>
                        </li>
                        <li>
                            <a href="https://twitter.com/collaboraction" target="_blank" rel="noopener noreferrer">
                                <img src="img/c4392d634a0148fda8b7b2b0ad98293b-1@2x.svg" alt="Twitter">
                            </a>
                        </li>
                        <li>
                            <a href="http://youtube.com/collaboraction" target="_blank" rel="noopener noreferrer">
                                <img src="img/e9bb463a1bc4434c9d33b81b1fe937f5-1@2x.svg" alt="YouTube">
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <script type="text/javascript">
            var w = document.querySelector("#width"),
                h = document.querySelector("#height"),
                c = document.querySelector("#calls"),
                timeout = false, // holder for timeout id
                delay = 250, // delay after event is "complete" to run callback
                calls = 0;

            // window.resize callback function
            function getDimensions() {
                w.innerHTML = window.innerWidth;
                h.innerHTML = window.innerHeight;
                calls += 1;
                c.innerHTML = calls;
            }

            // window.resize event listener
            window.addEventListener('resize', function() {
                // clear the timeout
                clearTimeout(timeout);
                // start timing for event "completion"
                timeout = setTimeout(getDimensions, delay);
            });

            getDimensions();
        </script>
    </body>

</html>